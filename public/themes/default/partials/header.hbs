{{! themes/default/partials/header.hbs }}
{{!
  This header provides a responsive navigation bar using Pico CSS and Alpine.js.
  Features a slide-in offcanvas sidebar for mobile with accordion sub-navigation.
}}
<div x-data="{ isMobileMenuOpen: false }" @keydown.escape.window="isMobileMenuOpen = false">
<header class="site-header relative">
    <div class="container">
        <div class="flex items-center justify-between" style="height: 60px;">
            
            {{!-- Site Logo/Title --}}
            <div class="flex-shrink-0">
                <a href="{{#if @root.options.isExport}}./index.html{{else}}/{{/if}}" class="site-logo flex items-center">
                    {{#if @root.headContext.logoUrl}}
                        <img src="{{@root.headContext.logoUrl}}" alt="{{@root.manifest.title}} logo" style="height: 2rem; width: auto; margin-right: 0.5rem;">
                    {{/if}}
                    <span>{{@root.manifest.title}}</span>
                </a>
            </div>

            {{!-- ================================== --}}
            {{!-- DESKTOP NAVIGATION (hidden on mobile) --}}
            {{!-- ================================== --}}
            <nav class="md:block hidden">
                <ul class="nav-list">
                    {{#each @root.navLinks}}
                        {{#if this.children.length}}
                            <li class="relative" 
                                x-data="{ 
                                    open: false, 
                                    alignRight: false,
                                    handleClick(e) {
                                        if (this.open) {
                                            // Second click - navigate to page
                                            return true; // Allow default navigation
                                        } else {
                                            // First click - open dropdown
                                            e.preventDefault();
                                            this.open = true;
                                            this.alignRight = ($el.getBoundingClientRect().right + 160) > window.innerWidth;
                                        }
                                    },
                                    handleMouseEnter() {
                                        this.open = true;
                                        this.alignRight = ($el.getBoundingClientRect().right + 160) > window.innerWidth;
                                    },
                                    handleMouseLeave() {
                                        this.open = false;
                                    }
                                }" 
                                @mouseenter="handleMouseEnter()" 
                                @mouseleave="handleMouseLeave()"
                                @click.away="open = false">
                                <a href="{{this.href}}" 
                                   @click="handleClick($event)"
                                   class="nav-link flex items-center py-2"
                                   :aria-expanded="open.toString()"
                                   aria-haspopup="true">
                                    <span>{{this.label}}</span>
                                    <svg style="margin-left: 0.25rem; height: 1rem; width: 1rem; transition: transform 0.2s;" :style="{ transform: open ? 'rotate(180deg)' : 'rotate(0deg)' }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </a>
                                {{!-- Dropdown Panel --}}
                                <div 
                                    x-show="open" 
                                    x-transition:enter="transition-all ease-out duration-200"
                                    x-transition:enter-start="opacity-0 scale-95"
                                    x-transition:enter-end="opacity-100 scale-100"
                                    x-transition:leave="transition-all ease-in duration-150"
                                    x-transition:leave-start="opacity-100 scale-100"
                                    x-transition:leave-end="opacity-0 scale-95"
                                    :class="alignRight ? 'right-0' : 'left-0'"
                                    class="absolute z-20" 
                                    style="margin-top: 0.25rem; width: 12rem; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); background: white; border: 1px solid var(--color-border);"
                                    x-cloak
                                >
                                    <ul style="list-style: none; margin: 0; padding: 0.5rem 0;">
                                        {{#each this.children}}
                                            <li>
                                                <a href="{{this.href}}" class="nav-link block" style="padding: 0.5rem 1rem; font-size: 0.875rem;">{{this.label}}</a>
                                            </li>
                                        {{/each}}
                                    </ul>
                                </div>
                            </li>
                        {{else}}
                            <li>
                                <a href="{{this.href}}" class="nav-link py-2">{{this.label}}</a>
                            </li>
                        {{/if}}
                    {{/each}}
                </ul>
            </nav>

            {{!-- ========================================= --}}
            {{!-- MOBILE MENU BUTTON (visible only on mobile) --}}
            {{!-- ========================================= --}}
            <div class="block md:hidden">
                <button 
                    @click="isMobileMenuOpen = !isMobileMenuOpen" 
                    type="button" 
                    class="mobile-menu-button"
                    aria-controls="mobile-menu" 
                    :aria-expanded="isMobileMenuOpen.toString()"
                >
                    <span style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;">Open main menu</span>
                    {{!-- Hamburger Icon --}}
                    <svg x-show="!isMobileMenuOpen" style="height: 1.5rem; width: 1.5rem;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                    {{!-- Close (X) Icon --}}
                    <svg x-show="isMobileMenuOpen" x-cloak style="height: 1.5rem; width: 1.5rem;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>


    {{!-- Header Announcement Banner --}}
    {{#if (themeData 'header_announcement')}}
        <div style="background: #e3f2fd;">
            <div class="container py-2">
                <div class="text-center text-small">
                    {{{themeData 'header_announcement'}}}
                </div>
            </div>
        </div>
    {{/if}}
</header>

{{!-- ============================================= --}}
{{!-- MOBILE MENU: Backdrop Overlay (Outside Header) --}}
{{!-- ============================================= --}}
<div 
    x-show="isMobileMenuOpen" 
    x-transition:enter="transition-opacity duration-300 ease-out"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition-opacity duration-200 ease-in"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    @click="isMobileMenuOpen = false"
    class="fixed z-40"
    style="top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); height: 100vh; width: 100vw;"
    x-cloak
></div>

{{!-- ============================================= --}}
{{!-- MOBILE MENU: Slide-in Sidebar (Outside Header) --}}
{{!-- ============================================= --}}
<div 
    x-show="isMobileMenuOpen" 
    x-transition:enter="transform transition ease-in-out duration-300 sm:duration-700"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transform transition ease-in-out duration-300 sm:duration-700"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    class="fixed z-50 flex flex-column"
    style="top: 0; right: 0; bottom: 0; background: white; box-shadow: -4px 0 6px rgba(0,0,0,0.1); height: 100vh; width: 280px;"
    id="mobile-menu"
    role="dialog"
    aria-modal="true"
    aria-labelledby="mobile-menu-title"
    x-cloak
    x-trap="isMobileMenuOpen"
>
    {{!-- Sidebar Header --}}
    <div class="flex items-center justify-between p-4" style="border-bottom: 1px solid var(--color-border);">
        <h2 id="mobile-menu-title" class="font-bold mb-0">Menu</h2>
        <button 
            @click="isMobileMenuOpen = false" 
            type="button" 
            class="mobile-menu-button"
            aria-label="Close menu"
        >
            <svg style="height: 1rem; width: 1rem;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </div>

    {{!-- Sidebar Navigation --}}
    <nav class="p-4 flex-auto" style="overflow-y: auto;">
        <ul style="list-style: none; margin: 0; padding: 0;">
            {{#each @root.navLinks}}
                <li class="mb-2">
                    {{#if this.children.length}}
                        {{!-- Parent Link with Accordion --}}
                        <div x-data="{ accordionOpen: false }">
                            <div class="flex items-center justify-between">
                                <a href="{{this.href}}" class="nav-link flex-auto py-2" @click="isMobileMenuOpen = false">
                                    {{this.label}}
                                </a>
                                <button 
                                    @click="accordionOpen = !accordionOpen" 
                                    type="button"
                                    class="mobile-menu-button"
                                    style="margin-left: 0.5rem;"
                                    :aria-expanded="accordionOpen.toString()"
                                    aria-label="Toggle submenu"
                                >
                                    <svg 
                                        style="height: 1rem; width: 1rem; color: #6c757d; transition: transform 0.2s;" 
                                        :style="{ transform: accordionOpen ? 'rotate(180deg)' : 'rotate(0deg)' }"
                                        fill="none" 
                                        viewBox="0 0 24 24" 
                                        stroke="currentColor"
                                    >
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            {{!-- Accordion Content --}}
                            <div 
                                x-show="accordionOpen" 
                                x-transition:enter="transition-all ease-out duration-200"
                                x-transition:enter-start="opacity-0 max-h-0"
                                x-transition:enter-end="opacity-100 max-h-screen"
                                x-transition:leave="transition-all ease-in duration-150"
                                x-transition:leave-start="opacity-100 max-h-screen"
                                x-transition:leave-end="opacity-0 max-h-0"
                                style="overflow: hidden;"
                            >
                                <ul style="list-style: none; margin: 0.5rem 0 0 0; padding: 0 0 0 1rem; border-left: 1px solid var(--color-border);">
                                    {{#each this.children}}
                                        <li style="padding: 0.25rem 0;">
                                            <a 
                                                href="{{this.href}}" 
                                                class="nav-link block text-small py-1" 
                                                style="color: #6c757d;"
                                                @click="isMobileMenuOpen = false"
                                            >
                                                {{this.label}}
                                            </a>
                                        </li>
                                    {{/each}}
                                </ul>
                            </div>
                        </div>
                    {{else}}
                        {{!-- Simple Link --}}
                        <a 
                            href="{{this.href}}" 
                            class="nav-link block py-2" 
                            @click="isMobileMenuOpen = false"
                        >
                            {{this.label}}
                        </a>
                    {{/if}}
                </li>
            {{/each}}
        </ul>
    </nav>
</div>
</div>